<htm>
  <header></header>
  <style>
    .item {
      display: inline-block;
      width: 30px;
      height: 30px;
      background-color: cornflowerblue;
      margin: 2px;
      text-align: center;
      font-size: 25px;
      vertical-align: middle;
      line-height: 30px;
    }
  </style>

  <body>
    <div id="board"></div>
  </body>
  <script>
    const N = 5; // 5 字棋
    const CLOUMN = 15; // 棋盘格子数
    let pattern = [];
    for (let i = 0; i < CLOUMN * CLOUMN; i++) { // 初始化棋盘
      pattern.push(0);
    }

    let current = 1;
    let items = [];
    const board = document.getElementById('board');

    function create() {
      board.innerHTML = "";
      for (let i = 0; i < CLOUMN * CLOUMN; i++) {
        const item = document.createElement('div');
        items.push(item);
        item.className = 'item';
        item.textContent = getColor(pattern[i]);
        item.addEventListener('click', () => move(i), { once: true});
        board.appendChild(item);
        if ((i + 1) % CLOUMN === 0) {
          board.appendChild(document.createElement('br'));
        }
      }
    }
    function show() {
      for (let i = 0; i < CLOUMN * CLOUMN; i++) {
        if (items[i].textContent !== getColor(pattern[i])) {
          items[i].textContent = getColor(pattern[i]);
        };
      }
    }

    function getColor(color) {
      return color === 2 ? '❌' : color === 1 ? '⭕️' : '';
    }

    function getXY(i) {
      const y = parseInt(i / CLOUMN);
      const x = i % CLOUMN;
      if (current === 1) {
        console.log(`${x},${y}`);
      }
      return {
        x, y
      };
    }

    function getI(x, y) {
      return y * CLOUMN + x;
    }

    function move(i) {
      pattern[i] = current;
      show();
      if (check(i)) {
        alert(`${getColor(current)} win !!`)
      }
      current = 3 - current;
    }

    /**
     * 判断落子点，横竖斜，是否有连子 N 个
     */     
    function check(i) {
      const { x, y } = getXY(i);
      // 横
      {
        let matchCount = 0;
        for (let j = y * CLOUMN + 1; j < y * CLOUMN + CLOUMN; j++) {
          if (matchCount >= N) {
            return true;
          }
          if (pattern[j] === current) {
            matchCount += 1;
          } else {
            matchCount = 0;
          }
        }
      }
      // 竖
      {
        let matchCount = 0;
        for (let j = x; j < CLOUMN * (CLOUMN - 1) - x + 1; j += CLOUMN) {
          if (matchCount >= N) {
            return true;
          }
          if (pattern[j] === current) {
            matchCount += 1;
          } else {
            matchCount = 0;
          }
        }
      }
      // 正斜
      {
        let matchCount = 0;
        const length = Math.abs(CLOUMN - (x + 1 - (y + 1)));
        const xStart = 0;
        const yStart = CLOUMN - length;
        if (length >= N) {
          for (let j = 0, _x = xStart, _y = yStart; j < length; _x++, _y++, j++) {
            const I = getI(_x, _y)
            if (pattern[I] === current) {
              matchCount += 1;
            } else {
              matchCount = 0;
            }
            if (matchCount >= N) {
              return true;
            }
          }
        }
      }
      // 反斜
      {
        let matchCount = 0;
        const length = Math.abs(CLOUMN - (x + 1 - (y + 1)));
        const yStart = 0;
        const xStart = CLOUMN - length;
        if (length >= N) {
          for (let j = 0, _x = xStart, _y = yStart; j < length; _x++, _y++, j++) {
            const I = getI(_x, _y)
            if (pattern[I] === current) {
              matchCount += 1;
            } else {
              matchCount = 0;
            }
            if (matchCount >= N) {
              return true;
            }
          }
        }
      }
    }

    // show();
    create();
  </script>
</htm>